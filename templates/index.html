{% extends "base.html" %}
{% block title %}Home — Personal Blog{% endblock %}

{% block content %}
  {% if featured %}
  <section class="mb-8">
    <h2 class="text-lg font-semibold mb-3">Featured</h2>
    <div class="grid md:grid-cols-2 gap-4">
      {% for p in featured %}
      <a href="{{ url_for('view_post', pid=p.id) }}" class="block rounded-xl p-5 bg-gradient-to-br from-slate-900 to-slate-800 border border-slate-700 hover:border-indigo-600">
        <div class="text-sm text-indigo-300 mb-1">{{ p.created_at.strftime("%b %d, %Y") }}{% if p.is_premium %} • Premium{% endif %}</div>
        <h3 class="text-xl font-semibold">{{ p.title }}</h3>
        <p class="mt-2 line-clamp-3 text-slate-300">{{ p.content[:180] }}{% if p.content|length > 180 %}…{% endif %}</p>
      </a>
      {% endfor %}
    </div>
  </section>

  <!-- Google AdSense for free users after featured posts -->
  {% if not current_user.is_subscriber and adsense_client %}
  <div class="my-6 flex justify-center">
    <ins class="adsbygoogle"
         style="display:block; width:100%; max-width:728px; height:90px;"
         data-ad-client="{{ adsense_client }}"
         data-ad-slot="{{ adsense_slot }}"
         data-ad-format="auto"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  {% endif %}
  {% endif %}

  <!-- Latest Posts -->
  <section>
    <h2 class="text-lg font-semibold mb-3">Latest</h2>
    <div class="space-y-3">
      {% for p in posts %}
      <div class="rounded-xl p-5 bg-slate-900/60 border border-slate-800 flex justify-between items-center">
        <div>
          <a href="{{ url_for('view_post', pid=p.id) }}" class="text-lg font-semibold hover:text-indigo-300">{{ p.title }}</a>
          <div class="text-sm text-slate-400">{{ p.created_at.strftime("%b %d, %Y") }} by {{ p.author.username }}{% if p.is_premium %} • <span class="text-amber-300">Premium</span>{% endif %}</div>
        </div>
        {% if current_user.is_authenticated and (current_user.id == p.user_id or current_user.is_owner) %}
        <div class="flex gap-2">
          <a class="px-3 py-1.5 rounded-lg bg-slate-800 hover:bg-slate-700" href="{{ url_for('edit_post', pid=p.id) }}">Edit</a>
        </div>
        {% endif %}
      </div>

      <!-- Google AdSense between latest posts for free users every 3 posts -->
      {% if not current_user.is_subscriber and loop.index % 3 == 0 and adsense_client %}
      <div class="my-6 flex justify-center">
        <ins class="adsbygoogle"
             style="display:block; width:100%; max-width:728px; height:90px;"
             data-ad-client="{{ adsense_client }}"
             data-ad-slot="{{ adsense_slot }}"
             data-ad-format="auto"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </div>
      {% endif %}

      {% else %}
      <p class="text-slate-400">No posts yet. <a class="underline" href="{{ url_for('create_post') }}">Write the first →</a></p>
      {% endfor %}
    </div>
  </section>
{% endblock %}
